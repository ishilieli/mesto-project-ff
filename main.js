(()=>{"use strict";var t=document.querySelector("#card-template").content;function e(e,n,r,o,i,a){var u=t.querySelector(".places__item").cloneNode(!0),c=u.querySelector(".card__delete-button"),s=u.querySelector(".card__like-button"),l=u.querySelector(".card__image"),d=u.querySelector(".like-count");return u.id=e._id,u.querySelector(".card__title").textContent=e.name,Object.assign(l,{src:e.link,alt:e.name}),e.likes.forEach((function(t){t._id===i&&s.classList.add("card__like-button_is-active")})),i!==e.owner._id?c.style.display="none":c.addEventListener("click",(function(t){a(t,e._id)})),s.addEventListener("click",(function(t){return r(t,d,e._id)})),l.addEventListener("click",(function(){return o(e)})),d.textContent=e.likes.length,u}function n(t){t.classList.add("popup_is-animated"),setTimeout((function(){t.classList.add("popup_is-opened")}),0),t.addEventListener("click",i),document.addEventListener("keydown",i)}function r(t){t.classList.remove("popup_is-opened"),setTimeout((function(){t.classList.remove("popup_is-animated")}),700),t.removeEventListener("click",i),document.removeEventListener("keydown",i)}function o(t,e){e.submitter.textContent=t?"Сохранение...":"Сохранить"}function i(t){"Escape"===t.key&&r(document.querySelector(".popup_is-opened")),t.target===t.currentTarget&&r(document.querySelector(".popup_is-opened"))}var a=document.querySelector(".places__list"),u=document.querySelector(".profile__add-button"),c=document.querySelector(".profile__edit-button"),s=document.querySelector(".profile__title"),l=document.querySelector(".profile__description"),d=document.querySelector(".profile__image"),p=document.querySelector(".popup__image"),f=document.querySelector(".popup__caption"),y=document.querySelector(".popup_type_image"),v=document.querySelector(".popup_type_edit"),m=document.querySelector(".popup_type_edit-avatar"),h=document.querySelector(".popup_type_new-card"),b=document.querySelectorAll(".popup__close"),_=document.forms.edit_profile,g=document.forms.new_place,S=document.forms.avatar,k=document.querySelector(".popup_type_delete-card"),E={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__error_visible"};function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function C(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,q(r.key),r)}}function q(t){var e=function(t,e){if("object"!=L(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=L(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==L(e)?e:e+""}var w=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.formSelector=e.formSelector,this.inputSelector=e.inputSelector,this.submitButtonSelector=e.submitButtonSelector,this.btn=n.querySelector(this.submitButtonSelector),this.inactiveButtonClass=e.inactiveButtonClass,this.inputErrorClass=e.inputErrorClass,this.errorClass=e.errorClass,this.inputList=Array.from(n.querySelectorAll(this.inputSelector))},(e=[{key:"showInputError",value:function(t,e){var n=t.nextElementSibling;t.classList.add(this.inputErrorClass),n.classList.add(this.errorClass),n.textContent=e}},{key:"hideInputError",value:function(t){var e=t.nextElementSibling;t.classList.remove(this.inputErrorClass),e.classList.remove(this.errorClass),e.textContent=""}},{key:"checkInputValidity",value:function(t){var e=t.validity.patternMismatch?t.dataset.errorMessage:t.validationMessage;t.validity.valid?this.hideInputError(t):this.showInputError(t,e)}},{key:"setEventListeners",value:function(){var t=this;this.inputList.forEach((function(e){e.addEventListener("input",(function(){t.checkInputValidity(e),t.toggleButtonState(e)}))}))}},{key:"toggleButtonState",value:function(){this.hasInvalidInput(this.inputList)?(this.btn.classList.add(this.inactiveButtonClass),this.btn.disabled=!0):(this.btn.classList.remove(this.inactiveButtonClass),this.btn.disabled=!1)}},{key:"enableValidation",value:function(){this.setEventListeners()}},{key:"hasInvalidInput",value:function(){return this.inputList.some((function(t){return!t.validity.valid}))}},{key:"resetValidity",value:function(){var t=this;this.inputList.forEach((function(e){t.hideInputError(e)}))}}])&&C(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}function P(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,x(r.key),r)}}function x(t){var e=function(t,e){if("object"!=j(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=j(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==j(e)?e:e+""}var O=function(){return t=function t(e,n){var r,o,i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,i=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},(o=x(o="getResponseStatus"))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i,this.link=e,this.headers=n},(e=[{key:"request",value:function(t,e){return fetch(t,e).then(this.getResponseStatus)}},{key:"setAvatar",value:function(t){return this.request("".concat(this.link,"/users/me/avatar"),{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:t})})}},{key:"getUserData",value:function(){return this.request("".concat(this.link,"/users/me"),{headers:this.headers})}},{key:"editProfile",value:function(t,e){return this.request("".concat(this.link,"/users/me"),{method:"PATCH",headers:this.headers,body:JSON.stringify({name:t,about:e})})}},{key:"getCardsData",value:function(){return this.request("".concat(this.link,"/cards"),{headers:this.headers})}},{key:"createUserCard",value:function(t){return this.request("".concat(this.link,"/cards"),{headers:this.headers,method:"POST",body:JSON.stringify(t)})}},{key:"deleteUserCard",value:function(t){return this.request("".concat(this.link,"/cards/").concat(t),{headers:this.headers,method:"DELETE"})}},{key:"toggleLike",value:function(t,e){return this.request("".concat(this.link,"/cards/likes/").concat(t),{method:"".concat(e),headers:this.headers})}}])&&P(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var I,A,B=new w(E,g),D=new w(E,_),U=new w(E,S),V=new O("https://nomoreparties.co/v1/wff-cohort-12",{authorization:"4165abdf-9d84-4bb7-8232-d514d6fbef88","Content-Type":"application/json"});function M(t){n(y),Object.assign(p,{src:t.link,alt:t.name}),f.textContent=t.name}function N(t,e){I=e,A=t.target.closest(".card"),n(k)}function J(t,e,n){(t.target.classList.contains("card__like-button_is-active")?V.toggleLike(n,"DELETE"):V.toggleLike(n,"PUT")).then((function(n){t.target.classList.toggle("card__like-button_is-active"),e.textContent=n.likes.length})).catch((function(t){return console.log(t)}))}B.enableValidation(),D.enableValidation(),U.enableValidation(),Promise.all([V.getCardsData(),V.getUserData()]).then((function(t){var n,r,o,i=(o=2,function(t){if(Array.isArray(t))return t}(r=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,u=[],c=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(u.push(r.value),u.length!==e);c=!0);}catch(t){s=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return u}}(r,o)||function(t,e){if(t){if("string"==typeof t)return T(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(t,e):void 0}}(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],c=i[1];d.style["background-image"]='url("'.concat(c.avatar,'")'),n=c,s.textContent=n.name,l.textContent=n.about,d.style["background-image"]='url("'.concat(n.avatar,'")'),_.name.value=n.name,_.description.value=n.about,u.forEach((function(t){return function(t,n,r,o,i,u){a.append(e(t,0,r,o,i,u))}(t,0,J,M,c._id,N)}))})).catch((function(t){return console.log(t)})),b.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){return r(e)}))})),_.addEventListener("submit",(function(t){t.preventDefault();var e={name:_.name.value,about:_.description.value};o(!0,t),V.editProfile(e.name,e.about).then((function(t){s.textContent=t.name,l.textContent=t.about,r(v)})).catch((function(t){return console.log(t)})).finally((function(){return o(!1,t)}))})),g.addEventListener("submit",(function(t){t.preventDefault(),o(!0,t);var n={name:t.target.place.value,link:t.target.link.value,likes:[]};V.createUserCard(n).then((function(t){a.prepend(e(t,0,J,M,t.owner._id,N)),r(h),g.reset()})).finally((function(){return o(!1,t)}))})),S.addEventListener("submit",(function(t){t.preventDefault(),o(!0,t),V.setAvatar(S.link.value).then((function(t){d.style["background-image"]='url("'.concat(t.avatar,'")'),r(m),S.reset()})).catch((function(t){return console.log(t)})).finally((function(){return o(!1,t)}))})),k.addEventListener("submit",(function(t){t.preventDefault(),V.deleteUserCard(I).then((function(){r(k),function(t){t.remove()}(A)})).catch((function(t){return console.log(t)}))})),d.addEventListener("click",(function(t){n(m),U.toggleButtonState()})),u.addEventListener("click",(function(){n(h),B.toggleButtonState()})),c.addEventListener("click",(function(){n(v),_.name.value=s.textContent,_.description.value=l.textContent,D.resetValidity()}))})();